(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{137:function(a,s,t){a.exports=t.p+"assets/img/image-20200107180352744.151a80a4.png"},138:function(a,s,t){a.exports=t.p+"assets/img/image-20200107180529223.132f43a9.png"},139:function(a,s,t){a.exports=t.p+"assets/img/image-20200107180558663.a009e134.png"},155:function(a,s,t){"use strict";t.r(s);var n=t(0),e=Object(n.a)({},(function(){var a=this,s=a.$createElement,n=a._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[n("h1",{attrs:{id:"二-spring-程序入口和xml解析"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二-spring-程序入口和xml解析"}},[a._v("#")]),a._v(" [二] Spring 程序入口和xml解析")]),a._v(" "),n("h2",{attrs:{id:"1-spring-源码下载"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#1-spring-源码下载"}},[a._v("#")]),a._v(" [1] Spring 源码下载")]),a._v(" "),n("p",[a._v("1、git clone --branch v5.1.3.RELEASE https://gitee.com/Z201/spring-framework.git。")]),a._v(" "),n("p",[a._v("2、gradle 下载，gradle 要 JDK8 的版本。")]),a._v(" "),n("p",[a._v("3、到下载的 spring 源码路径执行 gradle 命令。")]),a._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[a._v("gradlew :spring-oxm:compileTestJava\n")])])]),n("p",[a._v("4、用 idea 打开 spring 源码工程，在 idea 中安装插件 kotlin，重启 idea 5、把编译好的源码导入到工程中。")]),a._v(" "),n("h2",{attrs:{id:"2-把源码导入到工程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#2-把源码导入到工程"}},[a._v("#")]),a._v(" [2] 把源码导入到工程")]),a._v(" "),n("p",[n("img",{attrs:{src:t(137),alt:"image-20200107180352744"}})]),a._v(" "),n("p",[n("img",{attrs:{src:t(138),alt:"image-20200107180529223"}})]),a._v(" "),n("p",[n("img",{attrs:{src:t(139),alt:"image-20200107180558663"}})]),a._v(" "),n("h2",{attrs:{id:"3-导入-jar-依赖"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#3-导入-jar-依赖"}},[a._v("#")]),a._v(" [3] 导入 jar 依赖")]),a._v(" "),n("blockquote",[n("p",[a._v("Spring 中最核心的 4 个 jar")])]),a._v(" "),n("ul",[n("li",[a._v("Spring-beans")]),a._v(" "),n("li",[a._v("Spring-core")]),a._v(" "),n("li",[a._v("Spring-context")]),a._v(" "),n("li",[a._v("Spring-expression")])]),a._v(" "),n("blockquote",[n("p",[a._v("一个最最简单的 spring 工程，理论上就只需要一个 jar 就够了")])]),a._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("dependency"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("groupId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("springframework"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("groupId"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("artifactId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("spring"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("context"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("artifactId"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("version"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("spring"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("version"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("version"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("dependency"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),n("p",[a._v("Spring-context 包本身就依赖了，Spring-aop,Spring-beans,Spring-core 包")]),a._v(" "),n("p",[n("a",{attrs:{"data-fancybox":"",title:"Xml解析流程分析",href:"/assets/image-20200107180935504.png"}},[n("img",{attrs:{src:a.$withBase("/assets/image-20200107180935504.png"),alt:""}})])]),a._v(" "),n("blockquote",[n("p",[a._v("一个空的 spring 工程是不能打印日志的，要导入 spring 依赖的日志 jar")])]),a._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("dependency"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("groupId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("ch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("qos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("logback"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("groupId"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("artifactId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("logback"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("classic"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("artifactId"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("version"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("LATEST"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("version"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("dependency"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),n("h2",{attrs:{id:"4-spring-容器加载方式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#4-spring-容器加载方式"}},[a._v("#")]),a._v(" [4] Spring 容器加载方式")]),a._v(" "),n("ul",[n("li",[n("strong",[a._v("1、类路径获取配置文件")])])]),a._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ApplicationContext")]),a._v(" applicationContext"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ClassPathXmlApplicationContext")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"spring.xml"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),n("ul",[n("li",[n("strong",[a._v("2、文件系统路径获取配置文件[绝对路径]")])])]),a._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ApplicationContext")]),a._v(" applicationContext "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("FileSystemXmlApplicationContext")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"E:\\\\idea\\\\springdemo\\\\spring.xml"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),n("ul",[n("li",[n("strong",[a._v("3 、 无 配 置 文 件 加 载 容 器")])])]),a._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ApplicationContext")]),a._v(" applicationContext "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("AnnotationConfigApplicationContext")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"com.xx.jack"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),n("ul",[n("li",[n("strong",[a._v("4、springboot 加载容器")])])]),a._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ApplicationContext")]),a._v(" applicationContext "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("EmbeddedWebApplicationContext")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),n("h2",{attrs:{id:"5-spring-容器加载核心方法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#5-spring-容器加载核心方法"}},[a._v("#")]),a._v(" [5] Spring 容器加载核心方法")]),a._v(" "),n("p",[n("code",[a._v("AbstractApplicationContext.refresh()")]),a._v("方法\nrefresh()方法是 spring 容器启动过程中的核心方法，spring 容器要加载必须执行该方法。")]),a._v(" "),n("h2",{attrs:{id:"6-xml-流程分析"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#6-xml-流程分析"}},[a._v("#")]),a._v(" [6] Xml 流程分析")]),a._v(" "),n("p",[n("a",{attrs:{"data-fancybox":"",title:"Xml解析流程分析",href:"/assets/image-20200107185247851.png"}},[n("img",{attrs:{src:a.$withBase("/assets/image-20200107185247851.png"),alt:""}})])]),a._v(" "),n("h2",{attrs:{id:"7-自定义标签解析"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#7-自定义标签解析"}},[a._v("#")]),a._v(" [7] 自定义标签解析")]),a._v(" "),n("ul",[n("li",[n("strong",[a._v("1、获取自定义标签的 namespace 命令空间")]),a._v("，例如：")])]),a._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[a._v("http"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("www"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("org"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("schema"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("context\n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" namespaceUri "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[a._v("getNamespaceURI")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("ele"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),n("ul",[n("li",[n("strong",[a._v("2、根据命令空间获取 NamespaceHandler 对象")]),a._v("。")])]),a._v(" "),n("blockquote",[n("p",[a._v("NamespaceUri 和NamespaceHandler 之间会建立一个映射，spring 会从所有的spring jar 包中扫描 spring.handlers 文件，建立映射关系。")])]),a._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("NamespaceHandler")]),a._v(" handler "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("readerContext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[a._v("getNamespaceHandlerResolver")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[a._v("resolve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v(" namespaceUri"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Map")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Object")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" handlerMappings "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[a._v("getHandlerMappings")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Object")]),a._v(" handlerOrClassName "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" handlerMappings"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[a._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("namespaceUri"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),n("ul",[n("li",[n("strong",[a._v("3、反射获取 NamespaceHandler 实例")])])]),a._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("NamespaceHandler")]),a._v(" namespaceHandler "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("NamespaceHandler")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("BeanUtils")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[a._v("instantiateClass")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("handlerClass"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),n("ul",[n("li",[n("strong",[a._v("4、调用 init 方法")])])]),a._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[a._v("namespaceHandler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[a._v("init")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),n("ul",[n("li",[n("strong",[a._v("5、调用 parse 方法")])])]),a._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[a._v("handler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[a._v("parse")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("ele"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ParserContext")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("readerContext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" containingBd"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),n("div",{staticClass:"warning custom-block"},[n("p",{staticClass:"custom-block-title"},[a._v("扩展")]),a._v(" "),n("p",[a._v("spring.handler文件其实就是 namespaceUri 和类的完整限定名的映射。")])])])}),[],!1,null,null,null);s.default=e.exports}}]);